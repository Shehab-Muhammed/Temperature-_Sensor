#include "ADC_FUNC.h"
/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_INITIALIZE__________________________________________*/
/*_____________________________________________________________________________________________*/
#if defined SINGLE_MODE
void			ADC_INIT(uint_8 CHANNEL)
{
	DIO_SET_PIN_DIRECTION(ADC_PORT,CHANNEL,PIN_INPUT);
	DIO_CONNECT_PULL_UP(ADC_PORT,CHANNEL,PULL_UP_DISABLE);
	/*__________________________________________*/
	
	SET_BIT(ADMUX,REFS0);						//*************************************
												//*****REFERENCE_VOLTAGE_INTERNAL_2.56V
	SET_BIT(ADMUX,REFS1);						//*************************************
	/*___________________________________________________________*/
	
	CLEAR_BIT(ADCSRA,ADPS0);					//******************
	SET_BIT(ADCSRA,ADPS1);						//***PRESCALER_64***
	SET_BIT(ADCSRA,ADPS2);						//******************
	
	/*___________________________________________________________*/
	
	CLEAR_BIT(ADMUX,ADLAR);//DISABLE_ADC_LEFT_ADJUST :AD0-->AD7__ADCL******AD8-->AD9__ADCH
	CLEAR_BIT(ADCSRA,ADATE);//SINGLE_ENDED(CONV)
	/*__________________________________________*/
	
	SET_BIT(ADCSRA,ADEN);//EANABLE_OF_ADC
	
	/*__________________________________________*/
	
	
	switch (CHANNEL)
	{
		case 0:
		ADMUX|=0b00000000;
		break;
		
		case 1:
		ADMUX|=0b00000001;
		break;
		
		case 2:
		ADMUX|=0b00000010;
		break;
		
		case 3:
		ADMUX|=0b00000011;
		break;
		
		case 4:
		ADMUX|=0b00000100;
		break;
		
		case 5:
		ADMUX|=0b00000101;
		break;
		
		case 6:
		ADMUX|=0b00000110;
		break;
		
		case 7:
		ADMUX|=0b00000111;
		break;
		
	}
	/*___________________________________________________________*/
	/*___________________________________________________________*/
	
}
#endif
/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_INITIALIZE__________________________________________*/
/*_____________________________________________________________________________________________*/




/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_READ_VALUE__________________________________________*/
/*_____________________________________________________________________________________________*/

uint_16			ADC_READ(void)
{
		uint_16 ADC_VAL;
	/*___________________________________________________________*/
		SET_BIT(ADCSRA,ADSC);							//------>ADC_START_CONVERSION_SET_0_AFTER_FINISH
		//while(READ_BIT(ADCSRA,ADSC)==1);				//------>TRAP_ADC_UNTIL_CONV_FINISH_WHEN_0_ESCAPE
		while(READ_BIT(ADCSRA,ADIF)==0);				//------>TRAP_ADC_UNTIL_FLAG_SET_1
		CLEAR_BIT(ADCSRA,ADIF);							//SET_BIT(ADCSRA,ADIF)_____CONV_FINISH_FLAG_IS_1_NEED_TO_CLEAR
	/*___________________________________________________________*/
	/*___________________________________________________________*/
	
	ADC_VAL=(ADCL);
	ADC_VAL=ADC_VAL | (ADCH<<8);
	/*___________________________________________________________*/
	/*______________________ADC_VALUE_RETURNED___________________*/
	/*___________________________________________________________*/
	return ADC_VAL;
}

/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_READ_VALUE__________________________________________*/
/*_____________________________________________________________________________________________*/





/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_INTERRUPT_CONTROL___________________________________*/
/*_____________________________________________________________________________________________*/
void			ADC_INTERRUPT_EN(void)
{
	SET_BIT(STATUS_REG,I_BIT);
	SET_BIT(ADCSRA,ADIE);
}
void			ADC_INTERRUPT_DIS(void)
{
	CLEAR_BIT(STATUS_REG,I_BIT);
	CLEAR_BIT(ADCSRA,ADIE);
}
/*ISR(ADC_vect)
{
	CODE;
}*/

/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_INTERRUPT_CONTROL___________________________________*/
/*_____________________________________________________________________________________________*/






/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_AUTO_TRIG_CONTROL___________________________________*/
/*_____________________________________________________________________________________________*/

void			ADC_AUTO_TRIG_CONTROL(uint_8 MODE)
{
	SET_BIT(ADCSRA,ADATE);//AUTO_TRIGGER_MDOE
	switch(MODE)
	{
		case FREE_RUNING:
		SFIOR|=0b00000000;
		break;
		
		case ANALOG_COMPARATOR:
		SFIOR|=0b00100000;
		break;
		
		case EXTERNAL_INTERRUPT_REQ:
		SFIOR|=0b01000000;
		break;
		
		case TIMER0_COMPARE_MATCH:
		SFIOR|=0b01100000;
		break;
		
		
		case TIMER0_OVERFLOW:
		SFIOR|=0b10000000;
		break;
		
		
		case TIMER1_COMPARE_MATCH:
		SFIOR|=0b10100000;
		break;
		
		case TIMER1_OVERFLOW:
		SFIOR|=0b11000000;
		break;
		
		
		case TIMER1_CAPTURE_EVENT:
		SFIOR|=0b11100000;
		break;
		
		
	}
}

/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_AUTO_TRIG_CONTROL___________________________________*/
/*_____________________________________________________________________________________________*/





/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_DIFFERENTAIL_MODE___________________________________*/
/*_____________________________________________________________________________________________*/

#if defined DIFFRENTAIL_MODE
void			ADC_INIT_DIFFERENCTIAL_MODE(void)//----->ONLY_FOR_PA0_AND_PA1
{
	DIO_SET_PIN_DIRECTION(ADC_PORT,0,PIN_INPUT);//--->POSITIVE
	DIO_SET_PIN_DIRECTION(ADC_PORT,1,PIN_INPUT);//--->NEGATIVE
	DIO_CONNECT_PULL_UP(ADC_PORT,0,PULL_UP_DISABLE);
	DIO_CONNECT_PULL_UP(ADC_PORT,1,PULL_UP_DISABLE);
	/*__________________________________________*/
	
	SET_BIT(ADMUX,REFS0);						//*************************************
												//*****REFERENCE_VOLTAGE_INTERNAL_2.56V
	SET_BIT(ADMUX,REFS1);						//*************************************

	/*_____________________________________________*/
	
	CLEAR_BIT(ADCSRA,ADPS0);					//******************
	SET_BIT(ADCSRA,ADPS1);						//***PRESCALER_64***
	SET_BIT(ADCSRA,ADPS2);						//******************
	
	/*_____________________________________________*/
	CLEAR_BIT(ADMUX,ADLAR);//DISABLE_ADC_LEFT_ADJUST :AD0-->AD7__ADCL******AD8-->AD9__ADCH
	CLEAR_BIT(ADCSRA,ADATE);//SINGLE_ENDED(CONV)
	/*__________________________________________*/
	
	SET_BIT(ADCSRA,ADEN);//EANABLE_OF_ADC
	
	/*__________________________________________*/
	
	CLEAR_BIT(ADMUX,MUX0);
	CLEAR_BIT(ADMUX,MUX1);
	CLEAR_BIT(ADMUX,MUX2);
	CLEAR_BIT(ADMUX,MUX3);
	SET_BIT(ADMUX,MUX4);
	//ADMUX|=0b00010000; //MUX4--->1__MUX3~MUX0--->0______DIFFERENTIAL_ADD0(-VE)___ADC1(+VE)--->GAIN_1
	
}
#endif
/*_____________________________________________________________________________________________*/
/*_____________________________________ADC_DIFFERENTAIL_MODE___________________________________*/
/*_____________________________________________________________________________________________*/
